<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: participante.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: participante.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const moment = require('moment');
const firebase = require('firebase-admin')

/**
 * 
 * @param {*} firestore 
 * @param {*} req 
 * @param {*} res 
 */

const add = async(firestore, req, res)=>{
    const {
        nombre, 
        apellido_materno, 
        apellido_paterno, 
        nombre_corto, 
        fecha_nacimiento,
        estado_civil,  
		sexo, 
		email,
        escolaridad , 
        oficio, 
		capacitacion,
		domicilio
	} = req.body

   	//validar capacitacion 
   	const snapshot = await firestore.collection('capacitaciones').doc(capacitacion).get()
	if (!snapshot.exists){
       	return res.send({
           error: false, 
           message: 'no hay capacitacion con ese id'
       	})
   	}

   	var fn = firebase.firestore.Timestamp.fromDate(moment(fecha_nacimiento, 'YYYY-MM-DD').toDate())
   
   	var newPart = await firestore.collection('participantes').add({
		nombre,
		apellido_paterno,
		apellido_materno,
		nombre_corto,
		fecha_nacimiento: fn,
		estado_civil,
		sexo,
		email,
		escolaridad,
		oficio,
		domicilio,
        capacitacion,
        eliminado: false
	})
   	return res.send({
       error: false, 
       data: newPart.id
   	})
}

const edit = async (firestore, req, res)=>{
    const {
        id,
        nombre, 
        apellido_materno, 
        apellido_paterno, 
        nombre_corto, 
        fecha_nacimiento,
        estado_civil,  
		sexo, 
		email,
        escolaridad, 
        oficio, 
		domicilio
	} = req.body
    
    //validate participante
    const usersnap = await firestore.collection('participantes').doc(id).get() 
    if(!usersnap.exists){
        return res.send({
            error: true, 
            message: 'no hay participante con ese id'
        })
    }

    var fn = firebase.firestore.Timestamp.fromDate(moment(fecha_nacimiento, 'YYYY-MM-DD').toDate())

    const result = await firestore.collection('participantes').doc(id).set({
        nombre,
		apellido_paterno,
		apellido_materno,
		nombre_corto,
		fecha_nacimiento: fn,
		estado_civil,
		sexo,
		email,
		escolaridad,
		oficio,
		domicilio,
    }, {merge: true})

    if(!result){
        return res.send({
            error: true, 
            message: 'error writing to db'
        })
    }

    return res.send({
        error: false, 
        data: true
    })
}

var getone = async (firestore, req, res)=>{
    var { id } = req.params;
    const usersnap = await firestore.collection('participantes').doc(id).get() 
    if(!usersnap.exists){
        return res.send({
            error: true, 
            message: 'El participante no existe.'
        })
    }

    return res.send({
        error: false,
        data: {
            id: usersnap.id,
            ...usersnap.data()
        }
    })
}

var remove = async (firestore, req, res)=>{
    var { id } = req.params;
    const usersnap = await firestore.collection('participantes').doc(id).get();
    if(!usersnap.exists){
        return res.send({ error: false, data: true });
    }
    await firestore.collection('participantes').doc(id).update({
      eliminado: true  
    });
    return res.send({
        error: false,
        data: true
    })
}

module.exports = {
    add: add,
    edit: edit,
    getone,
    remove
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#add">add</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Mon Jun 08 2020 12:41:42 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
